# kit-ui å¼€å‘æµç¨‹ä¸å·¥å…·é“¾

## å¼€å‘ç¯å¢ƒé…ç½®

### 1. ç¯å¢ƒè¦æ±‚

```bash
# Node.js ç‰ˆæœ¬è¦æ±‚
Node.js >= 18.0.0
npm >= 9.0.0
pnpm >= 8.0.0 (æ¨è)

# å¼€å‘å·¥å…·
HBuilder + Volar æ’ä»¶
Git >= 2.30.0
```

## å¼€å‘å·¥å…·é“¾

### 2. ä»£ç è´¨é‡å·¥å…·

#### Prettier é…ç½®

```javascript
// prettier.config.js
export default {
  semi: false,
  singleQuote: true,
  trailingComma: 'none',
  printWidth: 100,
  tabWidth: 2,
  useTabs: false,
  endOfLine: 'lf',
  arrowParens: 'avoid',
  bracketSpacing: true,
  bracketSameLine: false,
  vueIndentScriptAndStyle: false
}
```

#### Stylelint é…ç½®

```javascript
// stylelint.config.js
export default {
  extends: [
    'stylelint-config-standard-scss',
    'stylelint-config-recommended-vue/scss'
  ],
  rules: {
    'selector-class-pattern': '^k-[a-z][a-z0-9]*(-[a-z0-9]+)*(__[a-z][a-z0-9]*(-[a-z0-9]+)*)?(--[a-z][a-z0-9]*(-[a-z0-9]+)*)?$',
    'scss/at-rule-no-unknown': [
      true,
      {
        ignoreAtRules: ['tailwind', 'apply', 'variants', 'responsive', 'screen']
      }
    ],
    'declaration-block-trailing-semicolon': null,
    'no-descending-specificity': null
  }
}
```

### 3. æµ‹è¯•å·¥å…·

## å¼€å‘æµç¨‹

### 1. åˆ†æ”¯ç®¡ç†ç­–ç•¥

#### Git Flow æ¨¡å‹

```base
main (ä¸»åˆ†æ”¯)
â”œâ”€â”€ develop (å¼€å‘åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/button-component (åŠŸèƒ½åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/input-component
â”‚   â””â”€â”€ feature/modal-component
â”œâ”€â”€ release/v1.0.0 (å‘å¸ƒåˆ†æ”¯)
â””â”€â”€ hotfix/critical-bug (çƒ­ä¿®å¤åˆ†æ”¯)
```

#### åˆ†æ”¯å‘½åè§„èŒƒ

```bash
# åŠŸèƒ½åˆ†æ”¯
feature/ç»„ä»¶å-åŠŸèƒ½æè¿°
feature/button-loading-state
feature/input-validation

# ä¿®å¤åˆ†æ”¯
fix/ç»„ä»¶å-é—®é¢˜æè¿°
fix/button-click-event
fix/modal-z-index

# å‘å¸ƒåˆ†æ”¯
release/ç‰ˆæœ¬å·
release/v1.0.0
release/v1.1.0

# çƒ­ä¿®å¤åˆ†æ”¯
hotfix/é—®é¢˜æè¿°
hotfix/security-vulnerability
hotfix/critical-crash
```

### 2. æäº¤è§„èŒƒ

#### Conventional Commits

```bash
# æ ¼å¼
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]

# ç±»å‹
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤é—®é¢˜
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: ä»£ç é‡æ„
perf: æ€§èƒ½ä¼˜åŒ–
test: æµ‹è¯•ç›¸å…³
chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

# ç¤ºä¾‹
feat(button): æ–°å¢ loading çŠ¶æ€æ”¯æŒ
fix(input): ä¿®å¤è¾“å…¥æ¡†åœ¨å°ç¨‹åºç«¯çš„æ ·å¼é—®é¢˜
docs(readme): æ›´æ–°å®‰è£…è¯´æ˜
style(button): è°ƒæ•´æŒ‰é’®é—´è·
refactor(modal): é‡æ„å¼¹çª—ç»„ä»¶é€»è¾‘
perf(list): ä¼˜åŒ–é•¿åˆ—è¡¨æ¸²æŸ“æ€§èƒ½
test(button): æ·»åŠ æŒ‰é’®ç»„ä»¶å•å…ƒæµ‹è¯•
chore(deps): å‡çº§ä¾èµ–ç‰ˆæœ¬
```

#### Commitlint é…ç½®

```javascript
// commitlint.config.js
export default {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'docs',
        'style',
        'refactor',
        'perf',
        'test',
        'chore',
        'revert'
      ]
    ],
    'scope-enum': [
      2,
      'always',
      [
        'button',
        'input',
        'modal',
        'list',
        'form',
        'layout',
        'theme',
        'utils',
        'docs',
        'build',
        'ci'
      ]
    ],
    'subject-max-length': [2, 'always', 72],
    'subject-case': [2, 'never', ['sentence-case', 'start-case', 'pascal-case', 'upper-case']]
  }
}
```

### 3. ä»£ç å®¡æŸ¥æµç¨‹

#### PR æ¨¡æ¿

```markdown
<!-- .github/PULL_REQUEST_TEMPLATE.md -->
## å˜æ›´ç±»å‹
- [ ] æ–°åŠŸèƒ½ (feat)
- [ ] ä¿®å¤é—®é¢˜ (fix)
- [ ] æ–‡æ¡£æ›´æ–° (docs)
- [ ] ä»£ç é‡æ„ (refactor)
- [ ] æ€§èƒ½ä¼˜åŒ– (perf)
- [ ] æµ‹è¯•ç›¸å…³ (test)
- [ ] å…¶ä»– (chore)

## å˜æ›´æè¿°
<!-- è¯¦ç»†æè¿°æœ¬æ¬¡å˜æ›´çš„å†…å®¹ -->

## ç›¸å…³ Issue
<!-- å…³è”çš„ Issue ç¼–å·ï¼Œå¦‚ #123 -->

## æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] E2E æµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•é€šè¿‡
- [ ] è·¨å¹³å°æµ‹è¯•é€šè¿‡

## æˆªå›¾/å½•å±
<!-- å¦‚æœæœ‰ UI å˜æ›´ï¼Œè¯·æä¾›æˆªå›¾æˆ–å½•å± -->

## æ£€æŸ¥æ¸…å•
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] å·²æ·»åŠ å¿…è¦çš„æµ‹è¯•
- [ ] å·²æ›´æ–°ç›¸å…³æ–‡æ¡£
- [ ] å·²è€ƒè™‘å‘åå…¼å®¹æ€§
- [ ] å·²æµ‹è¯•è·¨å¹³å°å…¼å®¹æ€§
```

#### å®¡æŸ¥è¦ç‚¹

```markdown
## ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æ€§
- [ ] åŠŸèƒ½å®ç°æ­£ç¡®
- [ ] è¾¹ç•Œæ¡ä»¶å¤„ç†
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ€§èƒ½è€ƒè™‘

### ä»£ç è´¨é‡
- [ ] ä»£ç å¯è¯»æ€§
- [ ] å‘½åè§„èŒƒ
- [ ] æ³¨é‡Šå®Œæ•´
- [ ] æ— é‡å¤ä»£ç 

### æµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡
- [ ] æµ‹è¯•ç”¨ä¾‹å®Œæ•´
- [ ] æµ‹è¯•é€šè¿‡

### å…¼å®¹æ€§
- [ ] è·¨å¹³å°å…¼å®¹
- [ ] å‘åå…¼å®¹
- [ ] æµè§ˆå™¨å…¼å®¹

### æ–‡æ¡£
- [ ] API æ–‡æ¡£
- [ ] ä½¿ç”¨ç¤ºä¾‹
- [ ] å˜æ›´æ—¥å¿—
```

### 4. è‡ªåŠ¨åŒ–æµç¨‹

#### GitHub Actions å·¥ä½œæµ

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'
      - run: pnpm install
      - run: pnpm lint
      - run: pnpm format:check

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'
      - run: pnpm install
      - run: pnpm test
      - run: pnpm test:coverage
      - uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'
      - run: pnpm install
      - run: pnpm playwright install
      - run: pnpm test:e2e
      - uses: actions/upload-artifact@v3
        if: failure()
        with:
          name: playwright-report
          path: playwright-report/

  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'
      - run: pnpm install
      - run: pnpm build
      - uses: actions/upload-artifact@v3
        with:
          name: dist
          path: dist/
```

#### å‘å¸ƒå·¥ä½œæµ

```yaml
# .github/workflows/release.yml
name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'
          registry-url: 'https://registry.npmjs.org'
      - run: pnpm install
      - run: pnpm build
      - run: pnpm test
      - run: pnpm publish --access public
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
      - name: Create GitHub Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          draft: false
          prerelease: false
```

## å¼€å‘è„šæœ¬

### 1. ç»„ä»¶ç”Ÿæˆè„šæœ¬

```typescript
// scripts/dev/create-component.ts
import { promises as fs } from 'fs'
import { resolve } from 'path'
import { pascalCase, kebabCase } from 'change-case'

interface ComponentOptions {
  name: string
  category: 'basic' | 'form' | 'layout' | 'navigation' | 'feedback' | 'display' | 'business'
  description: string
}

export async function createComponent(options: ComponentOptions) {
  const { name, category, description } = options
  const componentName = pascalCase(name)
  const kebabName = kebabCase(name)
  const prefixName = `k-${kebabName}`
  
  const componentDir = resolve(
    __dirname,
    `../../packages/components/src/components/${category}/${prefixName}`
  )
  
  // åˆ›å»ºç›®å½•
  await fs.mkdir(componentDir, { recursive: true })
  await fs.mkdir(resolve(componentDir, 'styles'), { recursive: true })
  await fs.mkdir(resolve(componentDir, '__tests__'), { recursive: true })
  await fs.mkdir(resolve(componentDir, 'docs'), { recursive: true })
  
  // ç”Ÿæˆç»„ä»¶æ–‡ä»¶
  await generateComponentFiles(componentDir, {
    componentName,
    kebabName,
    prefixName,
    description
  })
  
  console.log(`âœ… ç»„ä»¶ ${componentName} åˆ›å»ºæˆåŠŸï¼`)
  console.log(`ğŸ“ è·¯å¾„: ${componentDir}`)
}

async function generateComponentFiles(
  dir: string,
  context: {
    componentName: string
    kebabName: string
    prefixName: string
    description: string
  }
) {
  const { componentName, kebabName, prefixName, description } = context
  
  // ç»„ä»¶ä¸»æ–‡ä»¶
  const componentTemplate = `<template>
  <view :class="componentClasses" :style="componentStyles">
    <slot></slot>
  </view>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import type { ${componentName}Props, ${componentName}Emits } from './types'

defineOptions({
  name: '${componentName}'
})

const props = withDefaults(defineProps<${componentName}Props>(), {
  // é»˜è®¤å€¼
})

const emit = defineEmits<${componentName}Emits>()

const componentClasses = computed(() => {
  return [
    '${prefixName}',
    {
      // åŠ¨æ€ç±»å
    }
  ]
})

const componentStyles = computed(() => {
  return {
    // åŠ¨æ€æ ·å¼
  }
})
</script>

<style lang="scss">
@import './styles/index.scss';
</style>
`
  
  await fs.writeFile(resolve(dir, `${prefixName}.vue`), componentTemplate)
  
  // ç±»å‹å®šä¹‰æ–‡ä»¶
  const typesTemplate = `export interface ${componentName}Props {
  // Props å®šä¹‰
}

export interface ${componentName}Emits {
  // Events å®šä¹‰
}

export interface ${componentName}Slots {
  // Slots å®šä¹‰
  default?: () => any
}

export interface ${componentName}Instance {
  // å®ä¾‹æ–¹æ³•å®šä¹‰
}
`
  
  await fs.writeFile(resolve(dir, 'types.ts'), typesTemplate)
  
  // å¯¼å‡ºæ–‡ä»¶
  const indexTemplate = `import ${componentName} from './${prefixName}.vue'
import type { ${componentName}Props, ${componentName}Emits, ${componentName}Slots, ${componentName}Instance } from './types'

${componentName}.install = (app: App) => {
  app.component('${componentName}', ${componentName})
  app.component('${prefixName}', ${componentName})
}

export default ${componentName}
export { ${componentName} }
export type { ${componentName}Props, ${componentName}Emits, ${componentName}Slots, ${componentName}Instance }
`
  
  await fs.writeFile(resolve(dir, 'index.ts'), indexTemplate)
  
  // æ ·å¼æ–‡ä»¶
  const styleTemplate = `@import '../../../styles/mixins';
@import '../../../styles/variables';

.${prefixName} {
  // ç»„ä»¶æ ·å¼
}
`
  
  await fs.writeFile(resolve(dir, 'styles/index.scss'), styleTemplate)
  
  // æµ‹è¯•æ–‡ä»¶
  const testTemplate = `import { mount } from '@vue/test-utils'
import { describe, it, expect } from 'vitest'
import ${componentName} from '../${prefixName}.vue'

describe('${componentName}', () => {
  it('should render correctly', () => {
    const wrapper = mount(${componentName})
    expect(wrapper.classes()).toContain('${prefixName}')
  })
})
`
  
  await fs.writeFile(resolve(dir, '__tests__', `${prefixName}.test.ts`), testTemplate)
  
  // æ–‡æ¡£æ–‡ä»¶
  const docsTemplate = `# ${componentName} ${description}

${description}

## åŸºç¡€ç”¨æ³•

\`\`\`vue
<template>
  <${prefixName}></${prefixName}>
</template>
\`\`\`

## API

### Props

| å‚æ•° | è¯´æ˜ | ç±»å‹ | é»˜è®¤å€¼ |
| --- | --- | --- | --- |

### Events

| äº‹ä»¶å | è¯´æ˜ | å‚æ•° |
| --- | --- | --- |

### Slots

| æ’æ§½å | è¯´æ˜ |
| --- | --- |
| default | é»˜è®¤å†…å®¹ |
`
  
  await fs.writeFile(resolve(dir, 'docs/README.md'), docsTemplate)
}

// CLI å…¥å£
if (require.main === module) {
  const [name, category, description] = process.argv.slice(2)
  
  if (!name || !category || !description) {
    console.error('ç”¨æ³•: tsx create-component.ts <name> <category> <description>')
    console.error('ç¤ºä¾‹: tsx create-component.ts Button basic "æŒ‰é’®ç»„ä»¶"')
    process.exit(1)
  }
  
  createComponent({ name, category: category as any, description })
}
```

### 2. æ„å»ºè„šæœ¬

```typescript
// scripts/build/build-all.ts
import { execSync } from 'child_process'
import { resolve } from 'path'
import { promises as fs } from 'fs'

const packages = ['components', 'utils', 'theme', 'icons']

async function buildAll() {
  console.log('ğŸš€ å¼€å§‹æ„å»ºæ‰€æœ‰åŒ…...')
  
  for (const pkg of packages) {
    console.log(`ğŸ“¦ æ„å»º ${pkg}...`)
    
    try {
      execSync(`pnpm -C packages/${pkg} build`, {
        stdio: 'inherit',
        cwd: resolve(__dirname, '../..')
      })
      
      console.log(`âœ… ${pkg} æ„å»ºå®Œæˆ`)
    } catch (error) {
      console.error(`âŒ ${pkg} æ„å»ºå¤±è´¥:`, error)
      process.exit(1)
    }
  }
  
  console.log('ğŸ‰ æ‰€æœ‰åŒ…æ„å»ºå®Œæˆï¼')
}

buildAll()
```

### 3. å‘å¸ƒè„šæœ¬

```typescript
// scripts/release/version.ts
import { execSync } from 'child_process'
import { promises as fs } from 'fs'
import { resolve } from 'path'
import semver from 'semver'

type ReleaseType = 'patch' | 'minor' | 'major' | 'prerelease'

async function release(type: ReleaseType) {
  // æ£€æŸ¥å·¥ä½œåŒºçŠ¶æ€
  const status = execSync('git status --porcelain', { encoding: 'utf8' })
  if (status.trim()) {
    console.error('âŒ å·¥ä½œåŒºä¸å¹²å‡€ï¼Œè¯·å…ˆæäº¤æ‰€æœ‰æ›´æ”¹')
    process.exit(1)
  }
  
  // è¿è¡Œæµ‹è¯•
  console.log('ğŸ§ª è¿è¡Œæµ‹è¯•...')
  execSync('pnpm test', { stdio: 'inherit' })
  
  // æ„å»ºé¡¹ç›®
  console.log('ğŸ“¦ æ„å»ºé¡¹ç›®...')
  execSync('pnpm build', { stdio: 'inherit' })
  
  // è¯»å–å½“å‰ç‰ˆæœ¬
  const packageJson = JSON.parse(
    await fs.readFile(resolve(__dirname, '../../package.json'), 'utf8')
  )
  
  const currentVersion = packageJson.version
  const newVersion = semver.inc(currentVersion, type)
  
  if (!newVersion) {
    console.error('âŒ æ— æ³•ç”Ÿæˆæ–°ç‰ˆæœ¬å·')
    process.exit(1)
  }
  
  console.log(`ğŸ“ˆ ç‰ˆæœ¬å‡çº§: ${currentVersion} -> ${newVersion}`)
  
  // æ›´æ–°ç‰ˆæœ¬å·
  await updateVersion(newVersion)
  
  // ç”Ÿæˆå˜æ›´æ—¥å¿—
  console.log('ğŸ“ ç”Ÿæˆå˜æ›´æ—¥å¿—...')
  execSync('pnpm changelog', { stdio: 'inherit' })
  
  // æäº¤æ›´æ”¹
  execSync(`git add .`)
  execSync(`git commit -m "chore(release): v${newVersion}"`)
  
  // åˆ›å»ºæ ‡ç­¾
  execSync(`git tag v${newVersion}`)
  
  console.log(`ğŸ‰ å‘å¸ƒ v${newVersion} å®Œæˆï¼`)
  console.log('ğŸ’¡ è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¨é€åˆ°è¿œç¨‹:')
  console.log(`git push origin main && git push origin v${newVersion}`)
}

async function updateVersion(version: string) {
  const packages = ['package.json', 'packages/components/package.json', 'packages/utils/package.json']
  
  for (const pkgPath of packages) {
    const fullPath = resolve(__dirname, '../../', pkgPath)
    const pkg = JSON.parse(await fs.readFile(fullPath, 'utf8'))
    pkg.version = version
    await fs.writeFile(fullPath, JSON.stringify(pkg, null, 2) + '\n')
  }
}

// CLI å…¥å£
const type = process.argv[2] as ReleaseType
if (!['patch', 'minor', 'major', 'prerelease'].includes(type)) {
  console.error('ç”¨æ³•: tsx version.ts <patch|minor|major|prerelease>')
  process.exit(1)
}

release(type)
```
